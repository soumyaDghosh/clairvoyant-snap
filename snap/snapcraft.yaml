name: clairvoyant
base: core24
adopt-info: clairvoyant
grade: stable
confinement: strict
contact: soumyadeepghosh2004@zohomail.in
source-code: https://github.com/cassidyjames/clairvoyant
website: https://github.com/soumyaDghosh/clairvoyant-snap
compression: lzo
platforms:
  amd64:
  arm64:
  armhf:

parts:
  meson-deps:
    plugin: nil
    source: https://github.com/mesonbuild/meson.git
    source-tag: '1.5.1'
    source-depth: 1
    override-build: |
      python3 -m pip install --break-system-packages .
      mkdir -p $CRAFT_PART_INSTALL/usr/lib/python3/dist-packages
      rm -rf $CRAFT_PART_INSTALL/usr/lib/python3/dist-packages/meson*
      python3 -m pip install --target=$CRAFT_PART_INSTALL/usr --break-system-packages .
      mv $CRAFT_PART_INSTALL/usr/meson* $CRAFT_PART_INSTALL/usr/lib/python3/dist-packages/
      sed -i "s%^#!/usr/bin/python3$%#!/usr/bin/env python3%g" $CRAFT_PART_INSTALL/usr/bin/meson
    build-packages:
      - python3-pip

  clairvoyant:
    after: [meson-deps]
    plugin: meson
    source: https://github.com/cassidyjames/clairvoyant.git
    source-tag: '3.1.8'
    source-depth: 1
    build-environment:
      - PATH: ${CRAFT_STAGE}/usr/bin:${PATH}
    meson-parameters:
      - --prefix=/snap/clairvoyant/current/usr
    override-pull: |
      craftctl default
      sed -i '67,70s/.*//' ${CRAFT_PART_SRC}/src/MainWindow.vala
      sed -i 's|https://cassidyjames.com/support|https://github.com/soumyaDghosh/clairvoyant-snap/issues|g' ${CRAFT_PART_SRC}/data/metainfo.appdata.xml.in
      sed -i 's|https://github.com/cassidyjames/clairvoyant/issues|https://github.com/soumyaDghosh/clairvoyant-snap/issues|g' ${CRAFT_PART_SRC}/data/metainfo.appdata.xml.in
    organize:
      snap/clairvoyant/current: .
    parse-info: [usr/share/metainfo/com.github.cassidyjames.clairvoyant.metainfo.xml]

slots:
  clairvoyant:
    interface: dbus
    bus: session
    name: com.github.cassidyjames.clairvoyant

apps:
  clairvoyant:
    command: usr/bin/com.github.cassidyjames.clairvoyant
    desktop: usr/share/applications/com.github.cassidyjames.clairvoyant.desktop
    extensions: [gnome]
